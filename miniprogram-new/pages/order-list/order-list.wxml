<!--pages/order-list/order-list.wxml-->
<view class="order-list-page">
  <!-- çŠ¶æ€ç­›é€‰æ ‡ç­¾ -->
  <view class="status-tabs">
    <view 
      class="status-tab {{currentStatus === item.key ? 'active' : ''}}"
      wx:for="{{statusTabs}}"
      wx:key="key"
      bindtap="onStatusTabTap"
      data-status="{{item.key}}"
    >
      <text class="tab-label">{{item.label}}</text>
    </view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <scroll-view 
    class="order-list" 
    scroll-y
    refresher-enabled
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onPullDownRefresh"
    bindscrolltolower="onReachBottom"
  >
    <!-- è®¢å•å¡ç‰‡ -->
    <view 
      class="order-item"
      wx:for="{{orders}}"
      wx:key="id"
      bindtap="onOrderTap"
      data-id="{{item.id}}"
    >
      <!-- è®¢å•å¤´éƒ¨ -->
      <view class="order-header">
        <text class="order-no">è®¢å•å·ï¼š{{item.orderNo}}</text>
        <text class="order-status {{item.status}}">{{item.statusText}}</text>
      </view>

      <!-- å•†å“ä¿¡æ¯ -->
      <view class="order-product">
        <image 
          class="product-image" 
          src="{{item.product && item.product.image ? item.product.image : ''}}" 
          mode="aspectFill"
        />
        <view class="product-info">
          <text class="product-name">{{item.product && item.product.name ? item.product.name : 'å•†å“å·²ä¸‹æ¶'}}</text>
          <text class="product-subtitle" wx:if="{{item.itemCount > 1}}">ç­‰{{item.itemCount}}ä»¶å•†å“</text>
          <view class="product-spec">
            <text class="spec-text">æ•°é‡ï¼š{{item.quantity}}</text>
          </view>
          <view class="product-price">
            <text class="price-label">å®ä»˜ï¼š</text>
            <text class="price-value">{{item.totalAmountText}}</text>
          </view>
        </view>
      </view>

      <!-- è®¢å•æ“ä½œæŒ‰é’® -->
      <view class="order-actions" catchtap="stopPropagation">
        <view 
          class="action-btn secondary"
          wx:if="{{item.status === 'pending'}}"
          catchtap="onCancelOrder"
          data-id="{{item.id}}"
        >
          å–æ¶ˆè®¢å•
        </view>
        <view 
          class="action-btn primary"
          wx:if="{{item.status === 'pending'}}"
          catchtap="onPayOrder"
          data-id="{{item.id}}"
        >
          å»æ”¯ä»˜
        </view>
        <view 
          class="action-btn secondary"
          wx:if="{{item.status === 'shipped'}}"
          catchtap="onViewLogistics"
          data-id="{{item.id}}"
        >
          æŸ¥çœ‹ç‰©æµ
        </view>
        <view 
          class="action-btn primary"
          wx:if="{{item.status === 'shipped'}}"
          catchtap="onConfirmReceive"
          data-id="{{item.id}}"
        >
          ç¡®è®¤æ”¶è´§
        </view>
        <view 
          class="action-btn secondary"
          wx:if="{{item.status === 'delivered' || item.status === 'completed'}}"
          catchtap="onOrderTap"
          data-id="{{item.id}}"
        >
          æŸ¥çœ‹è¯¦æƒ…
        </view>
      </view>

      <!-- è®¢å•æ—¶é—´ -->
      <view class="order-time">
        <text class="time-text">{{item.createdAtText}}</text>
      </view>
    </view>

    <!-- åŠ è½½ä¸­ -->
    <view class="loading" wx:if="{{loading && orders.length > 0}}">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤šäº† -->
    <view class="no-more" wx:if="{{!hasMore && orders.length > 0}}">
      <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{empty && !loading}}">
      <text class="empty-icon">ğŸ“¦</text>
      <text class="empty-text">æš‚æ— è®¢å•</text>
      <text class="empty-desc">å¿«å»é€‰è´­å¿ƒä»ªçš„å•†å“å§</text>
    </view>

    <!-- é”™è¯¯çŠ¶æ€ -->
    <view class="error-state" wx:if="{{error && !loading && orders.length === 0}}">
      <text class="error-icon">âš ï¸</text>
      <text class="error-text">{{error}}</text>
      <button class="retry-btn" bindtap="refreshOrders">é‡è¯•</button>
    </view>
  </scroll-view>
</view>
