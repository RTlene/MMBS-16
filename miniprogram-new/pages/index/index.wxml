<!--pages/index/index.wxml-->
<view class="index-page">
  <!-- 浮动搜索栏 -->
  <view class="search-bar" style="opacity: {{searchOpacity}};">
    <view class="search-input" bindtap="onSearchTap">
      <text class="search-icon">🔍</text>
      <text class="search-placeholder">搜索商品</text>
    </view>
  </view>

  <!-- 轮播图 -->
  <view class="banner-section" wx:if="{{banners.length > 0}}">
    <swiper 
      class="banner-swiper" 
      indicator-dots="{{true}}"
      indicator-color="rgba(255, 255, 255, 0.5)"
      indicator-active-color="#FFFFFF"
      autoplay="{{true}}"
      interval="{{3000}}"
      duration="{{500}}"
      circular="{{true}}"
      bindchange="onBannerChange"
    >
      <swiper-item 
        wx:for="{{banners}}" 
        wx:key="id"
        bindtap="onBannerTap"
        data-index="{{index}}"
      >
        <view class="banner-slide">
          <image 
            class="banner-image" 
            src="{{item.imageUrl}}" 
            mode="aspectFill"
            binderror="onBannerImageError"
            data-index="{{index}}"
            show-menu-by-longpress="{{false}}"
            loading="eager"
          />
          <!-- 图片加载失败时的占位图 -->
          <view class="banner-placeholder" wx:if="{{item.loadError}}">
            <text class="placeholder-icon">📷</text>
            <text class="placeholder-text">图片加载失败</text>
          </view>
        </view>
      </swiper-item>
    </swiper>
  </view>
  
  <!-- 轮播图为空时的提示 -->
  <view class="banner-empty" wx:if="{{!loading && dataLoaded && banners.length === 0}}">
    <text class="empty-icon">🖼️</text>
    <text class="empty-text">暂无轮播图</text>
  </view>

  <!-- 占位内容：用于测试滑动效果 -->
  <view class="placeholder-section">
    <text class="placeholder-title">占位区块 A</text>
  </view>
  <view class="placeholder-section">
    <text class="placeholder-title">占位区块 B</text>
  </view>
  <view class="placeholder-section">
    <text class="placeholder-title">占位区块 C</text>
  </view>

  <!-- 分类导航 -->
  <view class="category-section" wx:if="{{categories.length > 0}}">
    <view class="category-grid">
      <view 
        class="category-item" 
        wx:for="{{categories}}" 
        wx:key="id"
        bindtap="onCategoryTap"
        data-id="{{item.id}}"
      >
        <image class="category-icon" src="{{item.icon || '../../images/category-default.png'}}" mode="aspectFit" />
        <text class="category-name">{{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- 推荐商品 -->
  <view class="product-section" wx:if="{{recommendProducts.length > 0}}">
    <view class="section-header">
      <view class="section-title">
        <text class="title-icon">⭐</text>
        <text class="title-text">精选推荐</text>
      </view>
      <view class="section-more" bindtap="onMoreRecommendTap">
        <text class="more-text">更多</text>
        <text class="more-arrow">›</text>
      </view>
    </view>
    
    <view class="product-grid">
      <view 
        class="product-item" 
        wx:for="{{recommendProducts}}" 
        wx:key="id"
        bindtap="onProductTap"
        data-id="{{item.id}}"
      >
        <view class="product-image-wrapper">
          <image class="product-image" src="{{item.images[0]}}" mode="aspectFill" />
          <view class="product-tag" wx:if="{{item.tags && item.tags.length > 0}}">
            {{item.tags[0]}}
          </view>
        </view>
        <view class="product-info">
          <text class="product-name">{{item.name}}</text>
          <view class="product-bottom">
            <view class="product-price">
              <text class="price-symbol">¥</text>
              <text class="price-value">{{item.price}}</text>
            </view>
            <text class="product-sales">已售{{item.sales || 0}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 热门商品 -->
  <view class="product-section" wx:if="{{hotProducts.length > 0}}">
    <view class="section-header">
      <view class="section-title">
        <text class="title-icon">🔥</text>
        <text class="title-text">热门商品</text>
      </view>
      <view class="section-more" bindtap="onMoreHotTap">
        <text class="more-text">更多</text>
        <text class="more-arrow">›</text>
      </view>
    </view>
    
    <view class="product-grid">
      <view 
        class="product-item" 
        wx:for="{{hotProducts}}" 
        wx:key="id"
        bindtap="onProductTap"
        data-id="{{item.id}}"
      >
        <view class="product-image-wrapper">
          <image class="product-image" src="{{item.images[0]}}" mode="aspectFill" />
          <view class="product-hot-tag">热</view>
        </view>
        <view class="product-info">
          <text class="product-name">{{item.name}}</text>
          <view class="product-bottom">
            <view class="product-price">
              <text class="price-symbol">¥</text>
              <text class="price-value">{{item.price}}</text>
            </view>
            <text class="product-sales">已售{{item.sales || 0}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 加载中 -->
  <view class="loading" wx:if="{{loading}}">
    <text>加载中...</text>
  </view>

  <!-- 错误状态 -->
  <view class="error-state" wx:if="{{!loading && hasError && dataLoaded}}">
    <text class="error-icon">⚠️</text>
    <text class="error-text">{{error || '加载失败，请稍后重试'}}</text>
    <button class="retry-btn" bindtap="loadPageData">重试</button>
  </view>

  <!-- 空状态（数据加载完成但无数据） -->
  <view class="empty" wx:if="{{!loading && !hasError && dataLoaded && recommendProducts.length === 0 && hotProducts.length === 0}}">
    <text class="empty-icon">📦</text>
    <text class="empty-text">暂无商品</text>
    <text class="empty-desc">商品正在准备中，敬请期待</text>
  </view>

  <!-- 分类为空提示 -->
  <view class="empty-category" wx:if="{{!loading && !hasError && dataLoaded && categories.length === 0}}">
    <text class="empty-category-text">暂无分类</text>
  </view>

  <!-- 底部安全区 -->
  <view class="safe-area-bottom"></view>
</view>

