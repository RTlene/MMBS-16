<!--pages/index/index.wxml - é¦–é¡µé‡æ’ç‰ˆï¼šé¦–å›¾è½®æ’­ã€æ´»åŠ¨æ¨ªå¹…ã€çƒ­é—¨å•†å“ã€èµ„è®¯åˆ—è¡¨ã€ç²¾é€‰æ¨èï¼Œå‡å¯åœ¨åå°ç®¡ç†-->
<view class="index-page">
  <!-- æµ®åŠ¨æœç´¢æ  -->
  <view class="search-bar" style="opacity: {{searchOpacity}};">
    <view class="search-input" bindtap="onSearchTap">
      <text class="search-icon">ğŸ”</text>
      <text class="search-placeholder">æœç´¢å•†å“</text>
    </view>
  </view>

  <!-- 1. é¦–å›¾è½®æ’­ï¼ˆåå°ï¼šè½®æ’­å›¾ç®¡ç† - ä½ç½®é€‰ã€Œé¦–é¡µé¦–å›¾ã€ï¼‰ -->
  <view class="banner-section" wx:if="{{banners.length > 0}}">
    <swiper
      class="banner-swiper"
      indicator-dots="{{true}}"
      indicator-color="rgba(255,255,255,0.5)"
      indicator-active-color="#FFFFFF"
      autoplay="{{true}}"
      interval="{{3000}}"
      duration="{{500}}"
      circular="{{true}}"
      bindchange="onBannerChange"
    >
      <swiper-item wx:for="{{banners}}" wx:key="id" bindtap="onBannerTap" data-index="{{index}}">
        <view class="banner-slide">
          <image class="banner-image" src="{{item.imageUrl}}" mode="aspectFill" binderror="onBannerImageError" data-index="{{index}}" show-menu-by-longpress="{{false}}" loading="eager" />
          <view class="banner-placeholder" wx:if="{{item.loadError}}">
            <text class="placeholder-icon">ğŸ“·</text>
            <text class="placeholder-text">å›¾ç‰‡åŠ è½½å¤±è´¥</text>
          </view>
        </view>
      </swiper-item>
    </swiper>
  </view>
  <view class="banner-empty" wx:if="{{!loading && dataLoaded && banners.length === 0}}">
    <text class="empty-icon">ğŸ–¼ï¸</text>
    <text class="empty-text">æš‚æ— è½®æ’­å›¾</text>
  </view>

  <!-- 2. æ´»åŠ¨æ¨ªå¹…è½®æ’­ï¼ˆåå°ï¼šè½®æ’­å›¾ç®¡ç† - ä½ç½®é€‰ã€Œæ´»åŠ¨æ¨ªå¹…ã€ï¼‰ -->
  <view class="activity-banner-section" wx:if="{{activityBanners.length > 0}}">
    <swiper
      class="activity-swiper"
      indicator-dots="{{true}}"
      indicator-color="rgba(0,0,0,0.2)"
      indicator-active-color="#3481B8"
      autoplay="{{true}}"
      interval="{{4000}}"
      duration="{{400}}"
      circular="{{true}}"
      bindchange="onActivityBannerChange"
    >
      <swiper-item wx:for="{{activityBanners}}" wx:key="id" bindtap="onActivityBannerTap" data-index="{{index}}">
        <image class="activity-banner-image" src="{{item.imageUrl}}" mode="aspectFill" />
      </swiper-item>
    </swiper>
  </view>

  <!-- 3. åˆ†ç±»å¯¼èˆªï¼ˆåå°ï¼šå•†å“åˆ†ç±»ç®¡ç†ï¼‰ -->
  <view class="category-section" wx:if="{{categories.length > 0}}">
    <view class="category-grid">
      <view class="category-item" wx:for="{{categories}}" wx:key="id" bindtap="onCategoryTap" data-id="{{item.id}}">
        <image class="category-icon" src="{{item.icon || '../../images/category-default.png'}}" mode="aspectFit" />
        <text class="category-name">{{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- 4. çƒ­é—¨å•†å“ï¼ˆåå°ï¼šå•†å“ç®¡ç† - å‹¾é€‰ã€Œçƒ­é—¨ã€ï¼‰ -->
  <view class="product-section" wx:if="{{hotProducts.length > 0}}">
    <view class="section-header">
      <view class="section-title">
        <text class="title-icon">ğŸ”¥</text>
        <text class="title-text">çƒ­é—¨å•†å“</text>
      </view>
      <view class="section-more" bindtap="onMoreHotTap">
        <text class="more-text">æ›´å¤š</text>
        <text class="more-arrow">â€º</text>
      </view>
    </view>
    <view class="product-grid">
      <view class="product-item" wx:for="{{hotProducts}}" wx:key="id" bindtap="onProductTap" data-id="{{item.id}}">
        <view class="product-image-wrapper">
          <image class="product-image" src="{{item.images[0]}}" mode="aspectFill" />
          <view class="product-hot-tag">çƒ­</view>
        </view>
        <view class="product-info">
          <text class="product-name">{{item.name}}</text>
          <view class="product-bottom">
            <view class="product-price">
              <text class="price-symbol">Â¥</text>
              <text class="price-value">{{item.price}}</text>
            </view>
            <text class="product-sales">å·²å”®{{item.sales || 0}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 5. èµ„è®¯åˆ—è¡¨ï¼ˆåå°ï¼šæ–‡ç« /èµ„è®¯ç®¡ç†ï¼Œé¦–é¡µå±•ç¤ºæœ€å¤š 5 æ¡ï¼‰ -->
  <view class="article-section" wx:if="{{homeArticles.length > 0}}">
    <view class="section-header">
      <view class="section-title">
        <text class="title-icon">ğŸ“°</text>
        <text class="title-text">èµ„è®¯</text>
      </view>
      <view class="section-more" bindtap="onMoreArticlesTap">
        <text class="more-text">æ›´å¤š</text>
        <text class="more-arrow">â€º</text>
      </view>
    </view>
    <view class="article-list">
      <view class="article-item" wx:for="{{homeArticles}}" wx:key="id" bindtap="onArticleTap" data-id="{{item.id}}">
        <image class="article-cover" src="{{item.coverImage}}" mode="aspectFill" wx:if="{{item.coverImage}}" />
        <view class="article-cover placeholder" wx:else><text class="article-placeholder-text">å›¾</text></view>
        <view class="article-info">
          <text class="article-title">{{item.title}}</text>
          <text class="article-summary" wx:if="{{item.summary}}">{{item.summary}}</text>
          <text class="article-time">{{item.publishTime}}</text>
        </view>
        <text class="article-arrow">â€º</text>
      </view>
    </view>
  </view>

  <!-- 6. ç²¾é€‰æ¨èï¼ˆåå°ï¼šå•†å“ç®¡ç† - å‹¾é€‰ã€Œæ¨èã€ï¼‰ -->
  <view class="product-section" wx:if="{{recommendProducts.length > 0}}">
    <view class="section-header">
      <view class="section-title">
        <text class="title-icon">â­</text>
        <text class="title-text">ç²¾é€‰æ¨è</text>
      </view>
      <view class="section-more" bindtap="onMoreRecommendTap">
        <text class="more-text">æ›´å¤š</text>
        <text class="more-arrow">â€º</text>
      </view>
    </view>
    <view class="product-grid">
      <view class="product-item" wx:for="{{recommendProducts}}" wx:key="id" bindtap="onProductTap" data-id="{{item.id}}">
        <view class="product-image-wrapper">
          <image class="product-image" src="{{item.images[0]}}" mode="aspectFill" />
          <view class="product-tag" wx:if="{{item.tags && item.tags.length > 0}}">{{item.tags[0]}}</view>
        </view>
        <view class="product-info">
          <text class="product-name">{{item.name}}</text>
          <view class="product-bottom">
            <view class="product-price">
              <text class="price-symbol">Â¥</text>
              <text class="price-value">{{item.price}}</text>
            </view>
            <text class="product-sales">å·²å”®{{item.sales || 0}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading" wx:if="{{loading}}"><text>åŠ è½½ä¸­...</text></view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-state" wx:if="{{!loading && hasError && dataLoaded}}">
    <text class="error-icon">âš ï¸</text>
    <text class="error-text">{{error || 'åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'}}</text>
    <button class="retry-btn" bindtap="loadPageData">é‡è¯•</button>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:if="{{!loading && !hasError && dataLoaded && recommendProducts.length === 0 && hotProducts.length === 0}}">
    <text class="empty-icon">ğŸ“¦</text>
    <text class="empty-text">æš‚æ— å•†å“</text>
    <text class="empty-desc">å•†å“æ­£åœ¨å‡†å¤‡ä¸­ï¼Œæ•¬è¯·æœŸå¾…</text>
  </view>

  <view class="empty-category" wx:if="{{!loading && !hasError && dataLoaded && categories.length === 0}}">
    <text class="empty-category-text">æš‚æ— åˆ†ç±»</text>
  </view>

  <view class="safe-area-bottom"></view>
</view>
