<!--pages/profile/profile.wxml-->
<view class="profile-page">
  
  <!-- 用户信息区 -->
  <view class="user-section">
    <view class="user-info" wx:if="{{isLogin && memberInfo}}">
      <image class="user-avatar" src="{{memberInfo.avatar || defaultAvatar}}" mode="aspectFill" />
      <view class="user-details">
        <text class="user-name">{{memberInfo.nickname || '会员'}}</text>
        <text class="user-level">{{memberInfo.levelName || '普通会员'}}</text>
      </view>
    </view>
    
    <view class="login-prompt" wx:else>
      <image class="user-avatar" src="{{defaultAvatar}}" mode="aspectFill" />
      <button class="login-btn" bindtap="onLogin">点击登录</button>
    </view>
  </view>

  <!-- 会员信息卡片：等级与升级进度 -->
  <view class="level-card-section" wx:if="{{isLogin && levelCard}}">
    <view class="level-card">
      <view class="level-card-title">会员信息</view>
      <!-- 会员等级 -->
      <view class="level-block member-level-block">
        <view class="level-block-header">
          <text class="level-block-label">会员等级</text>
          <text class="level-block-value">{{levelCard.memberProgress.currentLevelName}}</text>
        </view>
        <view class="level-block-body">
          <view class="progress-row">
            <text class="progress-desc">当前积分 {{levelCard.memberProgress.currentPoints}}</text>
            <text class="progress-next" wx:if="{{levelCard.memberProgress.nextLevelName}}">下一级：{{levelCard.memberProgress.nextLevelName}}</text>
          </view>
          <view class="progress-bar-wrap" wx:if="{{!levelCard.memberProgress.isMax}}">
            <view class="progress-bar" style="width: {{levelCard.memberProgress.progressPercent}}%;"></view>
          </view>
          <text class="progress-tip" wx:if="{{levelCard.memberProgress.tip}}">{{levelCard.memberProgress.tip}}</text>
          <text class="progress-tip max" wx:if="{{levelCard.memberProgress.isMax}}">{{levelCard.memberProgress.tip}}</text>
        </view>
      </view>
      <!-- 分销等级 -->
      <view class="level-block distributor-level-block" wx:if="{{levelCard.distributorProgress || levelCard.distributorLevel}}">
        <view class="level-block-header">
          <text class="level-block-label">分销等级</text>
          <text class="level-block-value">{{levelCard.distributorLevel ? levelCard.distributorLevel.name : '暂无'}}</text>
        </view>
        <view class="level-block-body" wx:if="{{levelCard.distributorProgress}}">
          <view class="progress-row">
            <text class="progress-desc">销售额 ¥{{levelCard.distributorProgress.salesText}}</text>
            <text class="progress-desc">{{levelCard.distributorProgress.fanText}}</text>
          </view>
          <view class="progress-bar-wrap" wx:if="{{!levelCard.distributorProgress.isMax && levelCard.distributorProgress.nextLevelName}}">
            <view class="progress-bar distributor-bar" style="width: {{levelCard.distributorProgress.progressPercent}}%;"></view>
          </view>
          <text class="progress-tip" wx:if="{{levelCard.distributorProgress.tip}}">{{levelCard.distributorProgress.tip}}</text>
        </view>
        <view class="level-block-body" wx:elif="{{!levelCard.distributorLevel}}">
          <text class="progress-tip">成为分销商后可按条件升级等级</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 订单统计 -->
  <view class="order-section" wx:if="{{isLogin}}">
    <view class="section-title" bindtap="goToOrders">
      <text>我的订单</text>
      <text class="title-arrow">查看全部 ›</text>
    </view>
    <view class="order-stats">
      <view class="order-stat-item" bindtap="goToOrders" data-status="pending">
        <text class="stat-icon icon-text">付</text>
        <text class="stat-label">待付款</text>
        <view class="stat-badge" wx:if="{{orderStats.pending > 0}}">{{orderStats.pending}}</view>
      </view>
      <view class="order-stat-item" bindtap="goToOrders" data-status="paid">
        <text class="stat-icon icon-text">发</text>
        <text class="stat-label">待发货</text>
        <view class="stat-badge" wx:if="{{orderStats.paid > 0}}">{{orderStats.paid}}</view>
      </view>
      <view class="order-stat-item" bindtap="goToOrders" data-status="shipped">
        <text class="stat-icon icon-text">收</text>
        <text class="stat-label">待收货</text>
        <view class="stat-badge" wx:if="{{orderStats.shipped > 0}}">{{orderStats.shipped}}</view>
      </view>
      <view class="order-stat-item" bindtap="goToOrders" data-status="completed">
        <text class="stat-icon icon-text">完</text>
        <text class="stat-label">已完成</text>
      </view>
    </view>
  </view>

  <!-- 功能菜单 -->
  <view class="menu-section">
    <view class="menu-item" bindtap="goToAddress">
      <text class="menu-icon icon-text">址</text>
      <text class="menu-label">收货地址</text>
      <text class="menu-arrow">›</text>
    </view>
    <view class="menu-item" bindtap="goToTeam">
      <text class="menu-icon icon-text">队</text>
      <text class="menu-label">我的团队</text>
      <text class="menu-arrow">›</text>
    </view>
    <view class="menu-item" bindtap="goToCoupons">
      <text class="menu-icon icon-text">券</text>
      <text class="menu-label">我的优惠券</text>
      <text class="menu-arrow">›</text>
    </view>
    <view class="menu-item" bindtap="goToVerification">
      <text class="menu-icon icon-text">码</text>
      <text class="menu-label">我的核销码</text>
      <text class="menu-arrow">›</text>
    </view>
    <view class="menu-item" bindtap="onContact">
      <text class="menu-icon icon-text">服</text>
      <text class="menu-label">联系客服</text>
      <text class="menu-arrow">›</text>
    </view>
    <view class="menu-item" bindtap="goToAbout">
      <text class="menu-icon icon-text">关</text>
      <text class="menu-label">关于我们</text>
      <text class="menu-arrow">›</text>
    </view>
  </view>

  <!-- 退出登录 -->
  <view class="logout-section" wx:if="{{isLogin}}">
    <button class="logout-btn" bindtap="onLogout">退出登录</button>
  </view>

  <!-- 底部安全区 -->
  <view class="safe-area-bottom"></view>
</view>

