<!--pages/profile/profile.wxml-->
<view class="profile-page">
  
  <!-- ç”¨æˆ·ä¿¡æ¯åŒº -->
  <view class="user-section">
    <view class="user-info" wx:if="{{isLogin && memberInfo}}">
      <image class="user-avatar" src="{{memberInfo.avatar || defaultAvatar}}" mode="aspectFill" />
      <view class="user-details">
        <text class="user-name">{{memberInfo.nickname || 'ä¼šå‘˜'}}</text>
        <text class="user-level">{{memberInfo.levelName || 'æ™®é€šä¼šå‘˜'}}</text>
      </view>
    </view>
    
    <view class="login-prompt" wx:else>
      <image class="user-avatar" src="{{defaultAvatar}}" mode="aspectFill" />
      <button class="login-btn" bindtap="onLogin">ç‚¹å‡»ç™»å½•</button>
    </view>
  </view>

  <!-- ä¼šå‘˜ä¿¡æ¯å¡ç‰‡ï¼šç­‰çº§ä¸å‡çº§è¿›åº¦ -->
  <view class="level-card-section" wx:if="{{isLogin && levelCard}}">
    <view class="level-card">
      <view class="level-card-title">ä¼šå‘˜ä¿¡æ¯</view>
      <!-- ä¼šå‘˜ç­‰çº§ -->
      <view class="level-block member-level-block">
        <view class="level-block-header">
          <text class="level-block-label">ä¼šå‘˜ç­‰çº§</text>
          <text class="level-block-value">{{levelCard.memberProgress.currentLevelName}}</text>
        </view>
        <view class="level-block-body">
          <view class="progress-row">
            <text class="progress-desc">å½“å‰ç§¯åˆ† {{levelCard.memberProgress.currentPoints}}</text>
            <text class="progress-next" wx:if="{{levelCard.memberProgress.nextLevelName}}">ä¸‹ä¸€çº§ï¼š{{levelCard.memberProgress.nextLevelName}}</text>
          </view>
          <view class="progress-bar-wrap" wx:if="{{!levelCard.memberProgress.isMax}}">
            <view class="progress-bar" style="width: {{levelCard.memberProgress.progressPercent}}%;"></view>
          </view>
          <text class="progress-tip" wx:if="{{levelCard.memberProgress.tip}}">{{levelCard.memberProgress.tip}}</text>
          <text class="progress-tip max" wx:if="{{levelCard.memberProgress.isMax}}">{{levelCard.memberProgress.tip}}</text>
        </view>
      </view>
      <!-- åˆ†é”€ç­‰çº§ -->
      <view class="level-block distributor-level-block" wx:if="{{levelCard.distributorProgress || levelCard.distributorLevel}}">
        <view class="level-block-header">
          <text class="level-block-label">åˆ†é”€ç­‰çº§</text>
          <text class="level-block-value">{{levelCard.distributorLevel ? levelCard.distributorLevel.name : 'æš‚æ— '}}</text>
        </view>
        <view class="level-block-body" wx:if="{{levelCard.distributorProgress}}">
          <view class="progress-row">
            <text class="progress-desc">é”€å”®é¢ Â¥{{levelCard.distributorProgress.salesText}}</text>
            <text class="progress-desc">{{levelCard.distributorProgress.fanText}}</text>
          </view>
          <view class="progress-bar-wrap" wx:if="{{!levelCard.distributorProgress.isMax && levelCard.distributorProgress.nextLevelName}}">
            <view class="progress-bar distributor-bar" style="width: {{levelCard.distributorProgress.progressPercent}}%;"></view>
          </view>
          <text class="progress-tip" wx:if="{{levelCard.distributorProgress.tip}}">{{levelCard.distributorProgress.tip}}</text>
        </view>
        <view class="level-block-body" wx:elif="{{!levelCard.distributorLevel}}">
          <text class="progress-tip">æˆä¸ºåˆ†é”€å•†åå¯æŒ‰æ¡ä»¶å‡çº§ç­‰çº§</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è®¢å•ç»Ÿè®¡ -->
  <view class="order-section" wx:if="{{isLogin}}">
    <view class="section-title" bindtap="goToOrders">
      <text>æˆ‘çš„è®¢å•</text>
      <text class="title-arrow">æŸ¥çœ‹å…¨éƒ¨ â€º</text>
    </view>
    <view class="order-stats">
      <view class="order-stat-item" bindtap="goToOrders" data-status="pending">
        <text class="stat-icon">ğŸ’°</text>
        <text class="stat-label">å¾…ä»˜æ¬¾</text>
        <view class="stat-badge" wx:if="{{orderStats.pending > 0}}">{{orderStats.pending}}</view>
      </view>
      <view class="order-stat-item" bindtap="goToOrders" data-status="paid">
        <text class="stat-icon">ğŸ“¦</text>
        <text class="stat-label">å¾…å‘è´§</text>
        <view class="stat-badge" wx:if="{{orderStats.paid > 0}}">{{orderStats.paid}}</view>
      </view>
      <view class="order-stat-item" bindtap="goToOrders" data-status="shipped">
        <text class="stat-icon">ğŸšš</text>
        <text class="stat-label">å¾…æ”¶è´§</text>
        <view class="stat-badge" wx:if="{{orderStats.shipped > 0}}">{{orderStats.shipped}}</view>
      </view>
      <view class="order-stat-item" bindtap="goToOrders" data-status="completed">
        <text class="stat-icon">âœ…</text>
        <text class="stat-label">å·²å®Œæˆ</text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section">
    <view class="menu-item" bindtap="goToAddress">
      <text class="menu-icon">ğŸ“</text>
      <text class="menu-label">æ”¶è´§åœ°å€</text>
      <text class="menu-arrow">â€º</text>
    </view>
    <view class="menu-item" bindtap="goToTeam">
      <text class="menu-icon">ğŸ‘¥</text>
      <text class="menu-label">æˆ‘çš„å›¢é˜Ÿ</text>
      <text class="menu-arrow">â€º</text>
    </view>
    <view class="menu-item" bindtap="goToCoupons">
      <text class="menu-icon">ğŸ«</text>
      <text class="menu-label">æˆ‘çš„ä¼˜æƒ åˆ¸</text>
      <text class="menu-arrow">â€º</text>
    </view>
    <view class="menu-item" bindtap="goToVerification">
      <text class="menu-icon">ğŸŸï¸</text>
      <text class="menu-label">æˆ‘çš„æ ¸é”€ç </text>
      <text class="menu-arrow">â€º</text>
    </view>
    <view class="menu-item" bindtap="onContact">
      <text class="menu-icon">ğŸ’¬</text>
      <text class="menu-label">è”ç³»å®¢æœ</text>
      <text class="menu-arrow">â€º</text>
    </view>
    <view class="menu-item" bindtap="goToAbout">
      <text class="menu-icon">â„¹ï¸</text>
      <text class="menu-label">å…³äºæˆ‘ä»¬</text>
      <text class="menu-arrow">â€º</text>
    </view>
  </view>

  <!-- é€€å‡ºç™»å½• -->
  <view class="logout-section" wx:if="{{isLogin}}">
    <button class="logout-btn" bindtap="onLogout">é€€å‡ºç™»å½•</button>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒº -->
  <view class="safe-area-bottom"></view>
</view>

