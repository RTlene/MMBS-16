<view class="refund-request-page">
  <scroll-view class="content" scroll-y>
    <!-- 说明 -->
    <view class="page-tip">
      <text class="tip-title">说明</text>
      <text class="tip-text">仅未发货或已取消的订单可在此申请退款，商家审核后处理。退货成功由商家统一办理退款，无需再申请；换货不涉及退款。</text>
    </view>

    <!-- 订单信息 -->
    <view class="section order-section" wx:if="{{order}}">
      <view class="section-head">
        <text class="section-title">订单信息</text>
      </view>
      <view class="section-body order-card">
        <view class="order-row">
          <text class="order-label">订单号</text>
          <text class="order-value">{{order.orderNo}}</text>
        </view>
        <view class="order-row">
          <text class="order-label">订单金额</text>
          <text class="order-value amount">¥{{formatAmount(order.totalAmount)}}</text>
        </view>
        <view class="order-row">
          <text class="order-label">可退金额</text>
          <text class="order-value highlight">¥{{formatAmount(order.returnAmount || order.totalAmount)}}</text>
        </view>
      </view>
    </view>

    <!-- 退款金额 -->
    <view class="section amount-section">
      <view class="section-head">
        <text class="section-title">退款金额</text>
        <text class="required">*</text>
      </view>
      <view class="section-body amount-row">
        <text class="amount-symbol">¥</text>
        <input
          class="amount-input"
          type="digit"
          placeholder="请输入退款金额"
          value="{{refundAmount}}"
          bindinput="onInputAmount"
        />
        <view class="amount-max" bindtap="onSetMaxAmount" wx:if="{{order}}">
          <text class="amount-max-text">最大 ¥{{formatAmount(order.returnAmount || order.totalAmount)}}</text>
        </view>
      </view>
    </view>

    <!-- 退款方式 -->
    <view class="section method-section">
      <view class="section-head">
        <text class="section-title">退款方式</text>
        <text class="required">*</text>
      </view>
      <view class="section-body method-list">
        <view
          class="method-item {{refundMethod === item.value ? 'active' : ''}}"
          wx:for="{{methods}}"
          wx:key="value"
          data-method="{{item.value}}"
          bindtap="onSelectMethod"
        >
          <text class="method-label">{{item.label}}</text>
          <text class="method-check" wx:if="{{refundMethod === item.value}}">✓</text>
        </view>
      </view>
    </view>

    <!-- 退款原因 -->
    <view class="section reason-section">
      <view class="section-head">
        <text class="section-title">退款原因</text>
        <text class="required">*</text>
      </view>
      <view class="section-body">
        <textarea
          class="reason-input"
          placeholder="请详细说明退款原因，便于商家审核"
          value="{{reason}}"
          bindinput="onInputReason"
          maxlength="500"
          auto-height
        />
        <view class="char-count">{{reason.length}}/500</view>
      </view>
    </view>

    <view class="bottom-spacer"></view>
  </scroll-view>

  <!-- 底部提交 -->
  <view class="bottom-bar">
    <button
      class="submit-btn"
      bindtap="onSubmit"
      loading="{{submitting}}"
      disabled="{{submitting}}"
    >
      提交申请
    </button>
  </view>
</view>
