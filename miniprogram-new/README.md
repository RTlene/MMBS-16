# MMBS-16 商城小程序（云托管版）

## 项目说明

这是基于微信云托管的商城小程序重构版本，与原小程序（`润祥/miniprogram-9`）的主要区别：

### 架构对比

| 特性 | 原小程序 | 新小程序 |
|-----|---------|---------|
| 数据存储 | 微信云数据库 | 云托管 MySQL |
| 后台逻辑 | 云函数 | 云托管 Node.js API |
| 用户认证 | 云开发 openid | HTTP API + openid |
| 图片存储 | 云存储 | 云存储（保留）|
| 支付 | 云支付 | 云支付（保留）|

### 技术栈

- **前端框架**: 微信小程序原生
- **后台API**: Node.js + Express + MySQL（云托管）
- **网络请求**: 自封装 request 工具
- **状态管理**: 全局 globalData
- **UI组件**: 原生组件 + 自定义组件

## 目录结构

```
miniprogram-new/
├── app.js                  # 小程序入口文件
├── app.json                # 全局配置
├── app.wxss                # 全局样式
├── config/                 # 配置文件
│   └── api.js             # API 地址配置
├── utils/                  # 工具类
│   ├── request.js         # 网络请求封装
│   ├── auth.js            # 认证相关
│   └── util.js            # 通用工具函数
├── pages/                  # 页面
│   ├── index/             # 首页（商城）
│   ├── category/          # 分类
│   ├── product/           # 商品详情
│   ├── cart/              # 购物车
│   └── profile/           # 个人中心
├── components/            # 自定义组件
├── images/                # 图片资源
└── project.config.json    # 项目配置
```

## 使用说明

### 1. 配置 API 地址

编辑 `config/api.js`，修改为你的云托管地址：

```javascript
const API_BASE_URL = 'https://你的云托管域名';
```

### 2. 配置 AppID

编辑 `project.config.json`，修改 `appid` 字段。

### 3. 添加合法域名

在小程序后台添加云托管域名到 `request合法域名`。

### 4. 本地调试

1. 使用微信开发者工具打开项目
2. 编译运行
3. 建议先在"不校验合法域名"模式下开发

## 功能模块

### ✅ 已实现功能

- [x] 用户登录与认证
- [x] 商品列表浏览
- [x] 商品详情（含运营工具价格）
- [x] 购物车管理
- [x] 订单创建
- [x] 个人中心
- [x] 会员信息管理

### 🚧 待开发功能

- [ ] 订单列表与详情
- [ ] 订单状态跟踪
- [ ] 退货退款申请
- [ ] 优惠券选择与使用
- [ ] 积分兑换
- [ ] 分享裂变功能
- [ ] 团队管理

## 开发规范

### 命名规范

- **文件名**: 小写字母，多个单词用 `-` 连接（如 `product-detail.js`）
- **变量名**: 小驼峰（如 `productList`）
- **常量名**: 大写字母，下划线分隔（如 `API_BASE_URL`）
- **函数名**: 小驼峰（如 `getProductList`）

### 代码风格

- 使用 ES6+ 语法
- 优先使用 `async/await` 处理异步
- 统一使用 2 空格缩进
- 添加必要的注释

### 错误处理

所有 API 请求必须包含错误处理：

```javascript
try {
  const res = await request.get('/products');
  // 处理成功逻辑
} catch (error) {
  wx.showToast({
    title: error.message || '请求失败',
    icon: 'none'
  });
}
```

## 调试技巧

### 1. 查看网络请求

开发者工具 → Network 标签，查看请求和响应。

### 2. 查看日志

使用 `console.log()` 输出调试信息，在 Console 标签查看。

### 3. 清除缓存

开发者工具 → 清缓存 → 清除所有缓存。

## 常见问题

### Q1: 请求返回 404

**A**: 检查 API 地址配置是否正确，后台服务是否已部署。

### Q2: 无法获取用户信息

**A**: 检查是否已调用登录接口，openid 是否已缓存。

### Q3: 图片不显示

**A**: 检查图片 URL 是否正确，是否添加到合法域名。

## 更新日志

### v1.0.0 (2025-10-01)

- 初始版本
- 实现基础商城功能
- 对接云托管后台 API

---

**技术支持**: 如有问题请查看项目文档或联系开发团队。

