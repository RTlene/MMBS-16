<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>积分设置</title>
    <link href="https://cdn.staticfile.org/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .point-settings-container { padding: 20px; background: #f5f5f5; min-height: 100vh; }
        .page-header { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .page-title { font-size: 24px; font-weight: 600; color: #333; margin: 0 0 8px 0; }
        .page-description { color: #666; margin: 0; font-size: 14px; }
        .tabs { display: flex; gap: 4px; margin-bottom: 16px; background: white; padding: 8px 12px 0; border-radius: 8px 8px 0 0; box-shadow: 0 2px 4px rgba(0,0,0,0.06); }
        .tab { padding: 10px 20px; cursor: pointer; border: none; background: transparent; font-size: 14px; color: #666; border-bottom: 2px solid transparent; }
        .tab:hover { color: #1890ff; }
        .tab.active { color: #1890ff; font-weight: 600; border-bottom-color: #1890ff; }
        .tab-panel { display: none; background: white; padding: 20px; border-radius: 0 8px 8px 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.06); }
        .tab-panel.active { display: block; }
        .stats-row { display: flex; flex-wrap: wrap; gap: 16px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); min-width: 140px; }
        .stat-label { font-size: 13px; color: #666; }
        .stat-value { font-size: 22px; font-weight: 600; color: #333; margin-top: 4px; }
        .content-card { background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); overflow: hidden; margin-bottom: 20px; }
        .content-card .card-header { padding: 16px 20px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; }
        .content-card .card-body { padding: 20px; }
        .table th { background: #fafafa; padding: 10px 12px; text-align: left; border-bottom: 1px solid #f0f0f0; font-size: 13px; }
        .table td { padding: 10px 12px; border-bottom: 1px solid #f0f0f0; font-size: 13px; }
        .table tbody tr:hover { background: #fafafa; }
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: 500; }
        .btn-primary { background: #1890ff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-sm { padding: 4px 10px; font-size: 12px; }
    </style>
</head>
<body>
    <div class="point-settings-container">
        <div class="page-header">
            <h1 class="page-title">积分设置</h1>
            <p class="page-description">配置积分来源、倍率设置和积分规则</p>
            <button type="button" class="btn btn-secondary btn-sm" style="margin-top:8px;" onclick="refreshData()">刷新</button>
        </div>

        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-label">积分来源</div>
                <div class="stat-value" id="sourceCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">倍率设置</div>
                <div class="stat-value" id="multiplierCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">规则设置</div>
                <div class="stat-value" id="ruleCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">启用设置</div>
                <div class="stat-value" id="activeCount">0</div>
            </div>
        </div>

        <div class="tabs">
            <button type="button" class="tab active" data-tab="source">积分来源配置</button>
            <button type="button" class="tab" data-tab="multiplier">倍率设置</button>
            <button type="button" class="tab" data-tab="rules">规则设置</button>
        </div>

        <div id="panel-source" class="tab-panel active">
            <div class="content-card">
                <div class="card-header">
                    <h5 class="mb-0" style="font-size:16px; font-weight:600;">积分来源配置</h5>
                    <button type="button" class="btn btn-primary btn-sm" onclick="showSourceConfigModal()">添加来源</button>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>来源名称</th>
                                    <th>基础积分</th>
                                    <th>基础倍率</th>
                                    <th>每日限制</th>
                                    <th>总限制</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="sourceConfigTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div id="panel-multiplier" class="tab-panel">
            <div class="content-card">
                <div class="card-header">
                    <h5 class="mb-0" style="font-size:16px; font-weight:600;">倍率设置</h5>
                    <button type="button" class="btn btn-primary btn-sm" onclick="showMultiplierConfigModal()">添加倍率</button>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>倍率名称</th>
                                    <th>倍率值</th>
                                    <th>适用条件</th>
                                    <th>优先级</th>
                                    <th>有效期</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="multiplierConfigTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div id="panel-rules" class="tab-panel">
            <div class="content-card">
                <div class="card-header">
                    <h5 class="mb-0" style="font-size:16px; font-weight:600;">规则设置</h5>
                    <button type="button" class="btn btn-primary btn-sm" onclick="showRuleConfigModal()">添加规则</button>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>规则名称</th>
                                    <th>规则类型</th>
                                    <th>积分来源</th>
                                    <th>基础积分</th>
                                    <th>倍率</th>
                                    <th>优先级</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="ruleConfigTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 积分来源配置模态框 -->
    <div class="modal fade" id="sourceConfigModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">积分来源配置</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="sourceConfigForm">
                        <input type="hidden" id="sourceConfigId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="sourceConfigSource" class="form-label">积分来源 <span class="text-danger">*</span></label>
                                    <select class="form-select" id="sourceConfigSource" required>
                                        <option value="">请选择来源</option>
                                        <option value="register">注册</option>
                                        <option value="order">订单</option>
                                        <option value="share">分享</option>
                                        <option value="invite">邀请</option>
                                        <option value="review">评价</option>
                                        <option value="signin">签到</option>
                                        <option value="activity">活动</option>
                                        <option value="admin">管理员赠送</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="sourceConfigName" class="form-label">来源名称 <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="sourceConfigName" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="sourceConfigBasePoints" class="form-label">基础积分 <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="sourceConfigBasePoints" min="0" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="sourceConfigMultiplier" class="form-label">基础倍率 <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="sourceConfigMultiplier" min="0" step="0.01" value="1.00" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="sourceConfigMaxDaily" class="form-label">每日最大积分</label>
                                    <input type="number" class="form-control" id="sourceConfigMaxDaily" min="0">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="sourceConfigMaxTotal" class="form-label">总最大积分</label>
                                    <input type="number" class="form-control" id="sourceConfigMaxTotal" min="0">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="sourceConfigDescription" class="form-label">描述</label>
                            <textarea class="form-control" id="sourceConfigDescription" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sourceConfigEnabled" checked>
                                <label class="form-check-label" for="sourceConfigEnabled">启用此来源</label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="saveSourceConfig()">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 倍率设置模态框 -->
    <div class="modal fade" id="multiplierConfigModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">倍率设置</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="multiplierConfigForm">
                        <input type="hidden" id="multiplierConfigId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="multiplierConfigName" class="form-label">倍率名称 <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="multiplierConfigName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="multiplierConfigValue" class="form-label">倍率值 <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="multiplierConfigValue" min="0" step="0.01" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="multiplierConfigPriority" class="form-label">优先级</label>
                                    <input type="number" class="form-control" id="multiplierConfigPriority" min="0" value="0">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="multiplierConfigValidFrom" class="form-label">生效开始时间</label>
                                    <input type="datetime-local" class="form-control" id="multiplierConfigValidFrom">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="multiplierConfigValidTo" class="form-label">生效结束时间</label>
                                    <input type="datetime-local" class="form-control" id="multiplierConfigValidTo">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="multiplierConfigConditions" class="form-label">适用条件</label>
                                    <select class="form-select" id="multiplierConfigConditions">
                                        <option value="">请选择条件</option>
                                        <option value="member_level">会员等级</option>
                                        <option value="order_amount">订单金额</option>
                                        <option value="time_period">时间段</option>
                                        <option value="product_category">商品分类</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="multiplierConfigDescription" class="form-label">描述</label>
                            <textarea class="form-control" id="multiplierConfigDescription" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="multiplierConfigEnabled" checked>
                                <label class="form-check-label" for="multiplierConfigEnabled">启用此倍率</label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="saveMultiplierConfig()">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 规则设置模态框 -->
    <div class="modal fade" id="ruleConfigModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">规则设置</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="ruleConfigForm">
                        <input type="hidden" id="ruleConfigId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="ruleConfigName" class="form-label">规则名称 <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="ruleConfigName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="ruleConfigType" class="form-label">规则类型 <span class="text-danger">*</span></label>
                                    <select class="form-select" id="ruleConfigType" required>
                                        <option value="">请选择类型</option>
                                        <option value="source">积分来源</option>
                                        <option value="rate">倍率设置</option>
                                        <option value="rule">规则设置</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="ruleConfigSource" class="form-label">积分来源 <span class="text-danger">*</span></label>
                                    <select class="form-select" id="ruleConfigSource" required>
                                        <option value="">请选择来源</option>
                                        <option value="register">注册</option>
                                        <option value="order">订单</option>
                                        <option value="share">分享</option>
                                        <option value="invite">邀请</option>
                                        <option value="review">评价</option>
                                        <option value="signin">签到</option>
                                        <option value="activity">活动</option>
                                        <option value="admin">管理员赠送</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="ruleConfigBasePoints" class="form-label">基础积分 <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="ruleConfigBasePoints" min="0" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="ruleConfigMultiplier" class="form-label">倍率 <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="ruleConfigMultiplier" min="0" step="0.01" value="1.00" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="ruleConfigPriority" class="form-label">优先级</label>
                                    <input type="number" class="form-control" id="ruleConfigPriority" min="0" value="0">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="ruleConfigMinOrderAmount" class="form-label">最低订单金额</label>
                                    <input type="number" class="form-control" id="ruleConfigMinOrderAmount" min="0" step="0.01">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="ruleConfigMaxOrderAmount" class="form-label">最高订单金额</label>
                                    <input type="number" class="form-control" id="ruleConfigMaxOrderAmount" min="0" step="0.01">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="ruleConfigValidFrom" class="form-label">生效开始时间</label>
                                    <input type="datetime-local" class="form-control" id="ruleConfigValidFrom">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="ruleConfigValidTo" class="form-label">生效结束时间</label>
                                    <input type="datetime-local" class="form-control" id="ruleConfigValidTo">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="ruleConfigConditions" class="form-label">额外条件配置 (JSON格式)</label>
                            <textarea class="form-control" id="ruleConfigConditions" rows="4" placeholder='{"memberLevel": "vip"}'></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="ruleConfigDescription" class="form-label">描述</label>
                            <textarea class="form-control" id="ruleConfigDescription" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="ruleConfigEnabled" checked>
                                <label class="form-check-label" for="ruleConfigEnabled">启用此规则</label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="saveRuleConfig()">保存</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
