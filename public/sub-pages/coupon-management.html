<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>优惠券管理</title>
    <style>
        .coupon-management-container { padding: 20px; background: #f5f5f5; min-height: 100vh; }
        .page-header { background: #fff; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .page-title { font-size: 24px; font-weight: 600; color: #333; margin-bottom: 8px; }
        .page-description { color: #666; font-size: 14px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 16px; margin-bottom: 20px; }
        .stat-card { background: #fff; padding: 16px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; }
        .stat-value { font-size: 28px; font-weight: 600; color: #1890ff; }
        .stat-label { color: #666; font-size: 13px; margin-top: 4px; }
        .filters { background: #fff; padding: 16px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .filter-row { display: flex; flex-wrap: wrap; gap: 12px; align-items: flex-end; }
        .filter-group { display: flex; flex-direction: column; gap: 4px; }
        .filter-label { font-size: 13px; color: #333; font-weight: 500; }
        .filter-input { padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 4px; font-size: 14px; min-width: 140px; }
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; }
        .btn-primary { background: #1890ff; color: #fff; }
        .btn-primary:hover { background: #40a9ff; }
        .btn-success { background: #52c41a; color: #fff; }
        .btn-success:hover { background: #73d13d; }
        .btn-danger { background: #ff4d4f; color: #fff; }
        .btn-danger:hover { background: #ff7875; }
        .btn-default { background: #fff; color: #333; border: 1px solid #d9d9d9; }
        .table-container { background: #fff; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); overflow-x: auto; }
        .table-header { padding: 16px 20px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
        .table-title { font-size: 18px; font-weight: 600; color: #333; }
        .table-actions { display: flex; gap: 8px; }
        .table { width: 100%; border-collapse: collapse; }
        .table th, .table td { padding: 12px; text-align: left; border-bottom: 1px solid #f0f0f0; }
        .table th { background: #fafafa; font-weight: 600; color: #333; font-size: 13px; }
        .table tbody tr:hover { background: #fafafa; }
        .status-active { background: #f6ffed; color: #52c41a; padding: 2px 8px; border-radius: 4px; font-size: 12px; }
        .status-inactive { background: #f5f5f5; color: #666; padding: 2px 8px; border-radius: 4px; font-size: 12px; }
        .status-expired { background: #fff1f0; color: #ff4d4f; padding: 2px 8px; border-radius: 4px; font-size: 12px; }
        .type-badge { background: #e6f7ff; color: #1890ff; padding: 2px 8px; border-radius: 4px; font-size: 12px; }
        .pagination { display: flex; justify-content: center; align-items: center; padding: 16px; gap: 8px; flex-wrap: wrap; }
        .pagination button { padding: 6px 12px; border: 1px solid #d9d9d9; background: #fff; cursor: pointer; border-radius: 4px; font-size: 13px; }
        .pagination button:hover:not(:disabled) { border-color: #1890ff; color: #1890ff; }
        .pagination button.active { background: #1890ff; color: #fff; border-color: #1890ff; }
        .pagination button:disabled { opacity: 0.5; cursor: not-allowed; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal.show { display: flex; }
        .modal-content { background: #fff; border-radius: 8px; width: 90%; max-width: 560px; max-height: 90vh; overflow-y: auto; }
        .modal-header { padding: 16px 20px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 18px; font-weight: 600; color: #333; }
        .close-btn { background: none; border: none; font-size: 22px; cursor: pointer; color: #999; line-height: 1; }
        .modal-body { padding: 20px; }
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; margin-bottom: 6px; font-weight: 500; color: #333; font-size: 14px; }
        .form-input { width: 100%; padding: 8px 12px; border: 1px solid #d9d9d9; border-radius: 4px; font-size: 14px; box-sizing: border-box; }
        .form-input:focus { outline: none; border-color: #1890ff; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .modal-footer { padding: 16px 20px; border-top: 1px solid #f0f0f0; display: flex; justify-content: flex-end; gap: 10px; }
        .form-hint { font-size: 12px; color: #999; margin-top: 4px; }
    </style>
</head>
<body>
    <div class="coupon-management-container">
        <div class="page-header">
            <h1 class="page-title">优惠券管理</h1>
            <p class="page-description">管理发放的优惠券，小程序端可领取与下单抵扣</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalCoupons">0</div>
                <div class="stat-label">券总数</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="activeCoupons">0</div>
                <div class="stat-label">启用中</div>
            </div>
        </div>

        <div class="filters">
            <div class="filter-row">
                <div class="filter-group">
                    <label class="filter-label">名称/代码</label>
                    <input type="text" class="filter-input" id="searchInput" placeholder="搜索">
                </div>
                <div class="filter-group">
                    <label class="filter-label">类型</label>
                    <select class="filter-input" id="typeFilter">
                        <option value="">全部</option>
                        <option value="discount">折扣券</option>
                        <option value="cash">代金券</option>
                        <option value="gift">礼品券</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">状态</label>
                    <select class="filter-input" id="statusFilter">
                        <option value="">全部</option>
                        <option value="active">启用</option>
                        <option value="inactive">禁用</option>
                        <option value="expired">已过期</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="searchCoupons()">搜索</button>
            </div>
        </div>

        <div class="table-container">
            <div class="table-header">
                <h2 class="table-title">优惠券列表</h2>
                <div class="table-actions">
                    <button class="btn btn-success" onclick="showAddModal()">新增优惠券</button>
                    <button class="btn btn-danger" onclick="window.CouponManagement.batchDelete()">批量删除</button>
                    <button class="btn btn-primary" onclick="window.CouponManagement.batchStatus('active')">批量启用</button>
                    <button class="btn btn-warning" onclick="window.CouponManagement.batchStatus('inactive')">批量停用</button>
                </div>
            </div>
            <table class="table">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="couponSelectAll" title="全选"></th>
                        <th>ID</th>
                        <th>名称</th>
                        <th>代码</th>
                        <th>类型</th>
                        <th>发放模式</th>
                        <th>面值/折扣</th>
                        <th>门槛</th>
                        <th>发放/已用</th>
                        <th>有效期</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="couponTableBody"></tbody>
            </table>
            <div class="pagination" id="pagination"></div>
        </div>
    </div>

    <div class="modal" id="couponModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="couponModalTitle">新增优惠券</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="couponForm">
                    <div class="form-group">
                        <label class="form-label">名称 <span style="color:#ff4d4f">*</span></label>
                        <input type="text" class="form-input" id="couponName" required placeholder="如：新人10元券">
                    </div>
                    <div class="form-group">
                        <label class="form-label">兑换码 <span style="color:#ff4d4f">*</span></label>
                        <input type="text" class="form-input" id="couponCode" required placeholder="唯一代码，如 NEW10">
                        <p class="form-hint">编辑时不可修改代码</p>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">券类型 <span style="color:#ff4d4f">*</span></label>
                            <select class="form-input" id="couponType" required>
                                <option value="cash">代金券</option>
                                <option value="discount">折扣券</option>
                                <option value="gift">礼品券</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">折扣类型 <span style="color:#ff4d4f">*</span></label>
                            <select class="form-input" id="couponDiscountType">
                                <option value="fixed">固定金额</option>
                                <option value="percentage">百分比</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">面值（元）</label>
                            <input type="number" class="form-input" id="couponValue" min="0" step="0.01" placeholder="如 100" value="100">
                        </div>
                        <div class="form-group">
                            <label class="form-label">折扣值 <span style="color:#ff4d4f">*</span></label>
                            <input type="number" class="form-input" id="couponDiscountValue" min="0" step="0.01" required placeholder="金额或折扣%">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">发放模式</label>
                        <select class="form-input" id="couponDistributionMode">
                            <option value="user_claim" selected>用户领取</option>
                            <option value="system">系统发放</option>
                            <option value="auto">自动</option>
                        </select>
                        <p class="form-hint">用户领取：用户可在优惠券中心主动领取；系统发放：由后台/规则发放给指定用户；自动：按规则自动发放。</p>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">最低订单金额（元）</label>
                            <input type="number" class="form-input" id="couponMinOrderAmount" min="0" step="0.01" placeholder="选填">
                        </div>
                        <div class="form-group">
                            <label class="form-label">发放总数 <span style="color:#ff4d4f">*</span></label>
                            <input type="number" class="form-input" id="couponTotalCount" min="1" required value="100">
                        </div>
                    </div>
                    <!-- 礼品券：赠品配置（仅当券类型为礼品券时显示） -->
                    <div class="form-group" id="giftConfigSection" style="display: none;">
                        <div style="border: 1px solid #e8e8e8; border-radius: 6px; padding: 12px; background: #fafafa;">
                            <label class="form-label" style="margin-bottom: 8px;">赠品配置 <span style="color:#ff4d4f">*</span></label>
                            <p class="form-hint" style="margin-bottom: 12px;">礼品券使用时将赠送下方指定商品，可设置满多少元送（0 表示无门槛即送）。</p>
                            <div class="form-row">
                                <div class="form-group" style="margin-bottom: 12px;">
                                    <label class="form-label">赠品商品</label>
                                    <select class="form-input" id="giftProductId">
                                        <option value="">请选择商品</option>
                                    </select>
                                </div>
                                <div class="form-group" style="margin-bottom: 12px;">
                                    <label class="form-label">赠品数量</label>
                                    <input type="number" class="form-input" id="giftQuantity" min="1" value="1" placeholder="1">
                                </div>
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">满多少元送（0=无门槛即送）</label>
                                <input type="number" class="form-input" id="giftMinAmount" min="0" step="0.01" value="0" placeholder="0 表示无门槛">
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">有效期开始 <span style="color:#ff4d4f">*</span></label>
                            <input type="datetime-local" class="form-input" id="couponValidFrom" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">有效期结束 <span style="color:#ff4d4f">*</span></label>
                            <input type="datetime-local" class="form-input" id="couponValidTo" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">状态</label>
                        <select class="form-input" id="couponStatus">
                            <option value="active">启用</option>
                            <option value="inactive">禁用</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">描述</label>
                        <textarea class="form-input" id="couponDescription" rows="2" placeholder="选填"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveCoupon()">保存</button>
                <button class="btn btn-default" onclick="closeModal()">取消</button>
            </div>
        </div>
    </div>

    <script src="../js/coupon-management.js"></script>
</body>
</html>
